import{a as Z,r as c,b as S,j as t}from"./react-vendor.348c3435.js";import{k as w,j as F}from"./lark-sdk.f4afa2a9.js";import{B as ee,F as s,a as te}from"./semi-ui.cc07b1c5.js";import"#minpath";import"#minproc";import"#minurl";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))b(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&b(u)}).observe(document,{childList:!0,subtree:!0});function d(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function b(n){if(n.ep)return;n.ep=!0;const o=d(n);fetch(n.href,o)}})();var I={},G=Z.exports;I.createRoot=G.createRoot,I.hydrateRoot=G.hydrateRoot;function ne(){const[f,h]=c.exports.useState([]),[d,b]=c.exports.useState(),[n,o]=c.exports.useState([]),u=c.exports.useRef(null),H=c.exports.useCallback(async e=>{const{table:g,columnx:i,columny:y,addedColumn:k,deletedColumn:B}=e;if(!g||!i||!y||!k||!B){alert("Please select all required columns");return}try{const p=await w.base.getTableById(g),X=await p.getFieldMetaList(),C=r=>X.find(l=>l.id===r),q=C(i),W=C(y),Q=C(k),U=C(B),O=(r,l)=>{const a=r==null?void 0:r.property;if(!a||!a.options)return l;const x=a.options.find(L=>L.id===l);return x?x.name:l},j=(r,l)=>l?Array.isArray(l)?l.map(a=>typeof a=="object"?a.text||a.name||JSON.stringify(a):O(r,String(a))):typeof l=="object"?[l.text||l.name||JSON.stringify(l)]:[O(r,String(l))]:[];let D=!0,P;const E=[];for(;D;){const r=await p.getRecords({pageSize:100,pageToken:P});E.push(...r.records),D=r.hasMore,P=r.pageToken}const A=[];E.forEach(r=>{const l=r.fields[i],a=r.fields[y],x=j(q,l),L=j(W,a),V=L.filter(m=>!x.includes(m)),_=x.filter(m=>!L.includes(m));console.log(`Record ${r.recordId}: Added: [${V.join(", ")}], Deleted: [${_.join(", ")}]`);const z=(m,M)=>{if(!M.length)return"";if((m==null?void 0:m.type)===F.MultiSelect){const R=m.property;return M.map(v=>{var $;const J=($=R==null?void 0:R.options)==null?void 0:$.find(Y=>Y.name===v);return J?{id:J.id}:null}).filter(v=>v!==null)}return M.join(", ")};A.push({recordId:r.recordId,fields:{[k]:z(Q,V),[B]:z(U,_)}})});const N=50;for(let r=0;r<A.length;r+=N){const l=A.slice(r,r+N);await p.setRecords(l)}alert("Columns compared and updated successfully!")}catch(p){console.error(p),alert("Failed to compare columns: "+(p instanceof Error?p.message:String(p)))}},[]);c.exports.useEffect(()=>{(async()=>{var y;const[g,i]=await Promise.all([w.base.getTableMetaList(),w.base.getSelection()]);h(g),i!=null&&i.tableId&&(b(i.tableId),(y=u.current)==null||y.setValues({table:i.tableId}))})()},[]);const K=c.exports.useCallback(e=>{b(typeof e=="string"?e:void 0)},[]);c.exports.useEffect(()=>{(async()=>{if(!d)return o([]);const i=await(await w.base.getTableById(d)).getFieldMetaList();o(i)})()},[d]);const T=n.filter(e=>e.type===F.Text||e.type===F.MultiSelect);return S("main",{className:"main",children:[t("h4",{children:"Compare Columns"}),t(ee,{type:"info",description:"Select two columns to compare. Differences will be written to the 'Added' and 'Deleted' columns (Text or MultiSelect).",style:{marginBottom:16}}),S(s,{labelPosition:"top",onSubmit:H,getFormApi:e=>u.current=e,children:[t(s.Slot,{label:"Reference",children:t("div",{children:t("a",{href:"https://lark-base-team.github.io/js-sdk-docs/en/start/core",target:"_blank",rel:"noopener noreferrer",children:"Base JS SDK"})})}),t(s.Slot,{label:"Data Template",children:t("div",{children:t("a",{href:"https://bytedance.larkoffice.com/wiki/SMr1w8o9QiEhRUkMN6pcjun3nvh?from=from_copylink",target:"_blank",rel:"noopener noreferrer",children:"Data Template"})})}),t(s.Slot,{label:"Development log",children:t("div",{children:t("a",{href:"https://bytedance.larkoffice.com/wiki/AelJwBthTiXx7xk9G34cRXWInMd",target:"_blank",rel:"noopener noreferrer",children:"Development Log"})})}),t(s.Select,{field:"table",label:"Select Table",placeholder:"Please select a Table",style:{width:"100%"},onChange:K,children:f.map(({id:e,name:g})=>t(s.Select.Option,{value:e,children:g},e))}),S("div",{style:{display:"flex",gap:"16px",marginBottom:"16px"},children:[t(s.Select,{field:"columnx",label:"Select Column X (Baseline)",placeholder:"Please select a Column as Baseline",style:{flex:1},disabled:n.length===0,children:n.map(e=>t(s.Select.Option,{value:e.id,children:e.name},e.id))}),t(s.Select,{field:"columny",label:"Select Column Y (Comparison)",placeholder:"Please select a Column as Comparison",style:{flex:1},disabled:n.length===0,children:n.map(e=>t(s.Select.Option,{value:e.id,children:e.name},e.id))})]}),S("div",{style:{display:"flex",gap:"16px",marginBottom:"16px"},children:[t(s.Select,{field:"addedColumn",label:"Select 'Added' Column (Text or MultiSelect)",placeholder:"Please select the 'Added' column",style:{flex:1},disabled:T.length===0,children:T.map(e=>t(s.Select.Option,{value:e.id,children:e.name},e.id))}),t(s.Select,{field:"deletedColumn",label:"Select 'Deleted' Column (Text or MultiSelect)",placeholder:"Please select the 'Deleted' column",style:{flex:1},disabled:T.length===0,children:T.map(e=>t(s.Select.Option,{value:e.id,children:e.name},e.id))})]}),t(te,{theme:"solid",htmlType:"submit",style:{marginTop:16},children:"Compare columns"})]})]})}function re(f){const[h,d]=c.exports.useState(!1),b=t("div",{children:S("div",{className:"errTop",children:['After running the project, please get the webview address and paste it into the Base table "Extended Script" for use. See:\xA0',t("a",{target:"_blank",href:"https://bytedance.feishu.cn/docx/HazFdSHH9ofRGKx8424cwzLlnZc",children:"Development Guide"})]})});return c.exports.useEffect(()=>{if(f.neverShowBanner)return;const n=new Promise((o,u)=>{setTimeout(()=>{u(!1)},3e3)});Promise.race([w.bridge.getLanguage(),n]).then(o=>{d(!1)}).catch(()=>{d(!0)})},[]),f.neverShowBanner?f.children||null:S("div",{children:[h&&b,f.children]})}I.createRoot(document.getElementById("root")).render(t(re,{children:t(ne,{})}));
