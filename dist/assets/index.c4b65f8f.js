import{a as Q,r as c,b as h,j as n}from"./react-vendor.348c3435.js";import{k as C,j as P}from"./lark-sdk.f4afa2a9.js";import{B as ee,F as s,a as te}from"./semi-ui.cc07b1c5.js";import"#minpath";import"#minproc";import"#minurl";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))b(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&b(u)}).observe(document,{childList:!0,subtree:!0});function d(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerpolicy&&(l.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?l.credentials="include":t.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function b(t){if(t.ep)return;t.ep=!0;const l=d(t);fetch(t.href,l)}})();var k={},G=Q.exports;k.createRoot=G.createRoot,k.hydrateRoot=G.hydrateRoot;function ne(){const[f,g]=c.exports.useState([]),[d,b]=c.exports.useState(),[t,l]=c.exports.useState([]),u=c.exports.useRef(null),X=c.exports.useCallback(async e=>{const{table:y,columnx:i,columny:x,addedColumn:T,deletedColumn:A}=e;if(!y||!i||!x||!T||!A){alert("Please select all required columns");return}try{const p=await C.base.getTableById(y),W=await p.getFieldMetaList(),F=r=>W.find(o=>o.id===r),Y=F(i),q=F(x),J=F(T),Z=F(A),O=(r,o)=>{const a=r==null?void 0:r.property;if(!a||!a.options)return o;const S=a.options.find(L=>L.id===o);return S?S.name:o},R=(r,o)=>o?Array.isArray(o)?o.map(a=>typeof a=="object"?a.text||a.name||JSON.stringify(a):O(r,String(a))):typeof o=="object"?[o.text||o.name||JSON.stringify(o)]:[O(r,String(o))]:[];let M=!0,j;const v=[];for(;M;){const r=await p.getRecords({pageSize:100,pageToken:j});v.push(...r.records),M=r.hasMore,j=r.pageToken}const B=[];v.forEach(r=>{const o=r.fields[i],a=r.fields[x],S=R(Y,o),L=R(q,a),N=L.filter(m=>!S.includes(m)),z=S.filter(m=>!L.includes(m));console.log(`Record ${r.recordId}: Added: [${N.join(", ")}], Deleted: [${z.join(", ")}]`);const H=(m,E)=>E.length?(m==null?void 0:m.type)===P.MultiSelect?E.map(K=>{var _;const I=m.property,V=(_=I==null?void 0:I.options)==null?void 0:_.find(U=>U.name===K);return V?{id:V.id}:{name:K}}):E.join(", "):null;B.push({recordId:r.recordId,fields:{[T]:H(J,N),[A]:H(Z,z)}})});const D=50;for(let r=0;r<B.length;r+=D){const o=B.slice(r,r+D);await p.setRecords(o)}alert("Columns compared and updated successfully!")}catch(p){console.error(p),alert("Failed to compare columns: "+(p instanceof Error?p.message:String(p)))}},[]);c.exports.useEffect(()=>{(async()=>{var x;const[y,i]=await Promise.all([C.base.getTableMetaList(),C.base.getSelection()]);g(y),i!=null&&i.tableId&&(b(i.tableId),(x=u.current)==null||x.setValues({table:i.tableId}))})()},[]);const $=c.exports.useCallback(e=>{b(typeof e=="string"?e:void 0)},[]);c.exports.useEffect(()=>{(async()=>{if(!d)return l([]);const i=await(await C.base.getTableById(d)).getFieldMetaList();l(i)})()},[d]);const w=t.filter(e=>e.type===P.Text||e.type===P.MultiSelect);return h("main",{className:"main",children:[n("h4",{children:"Compare Columns"}),n(ee,{type:"info",description:"Select two columns to compare. Differences will be written to the 'Added' and 'Deleted' columns (Text or MultiSelect).",style:{marginBottom:16}}),h(s,{labelPosition:"top",onSubmit:X,getFormApi:e=>u.current=e,children:[n(s.Slot,{label:"Development guide",children:h("div",{children:[n("a",{href:"https://lark-technologies.larksuite.com/docx/HvCbdSzXNowzMmxWgXsuB2Ngs7d",target:"_blank",rel:"noopener noreferrer",children:"Base Extensions Guide"}),"\u3001",n("a",{href:"https://bytedance.feishu.cn/docx/HazFdSHH9ofRGKx8424cwzLlnZc",target:"_blank",rel:"noopener noreferrer",children:"\u591A\u7EF4\u8868\u683C\u63D2\u4EF6\u5F00\u53D1\u6307\u5357"})]})}),n(s.Slot,{label:"API",children:h("div",{children:[n("a",{href:"https://lark-technologies.larksuite.com/docx/Y6IcdywRXoTYSOxKwWvuLK09sFe",target:"_blank",rel:"noopener noreferrer",children:"Base Extensions Front-end API"}),"\u3001",n("a",{href:"https://bytedance.feishu.cn/docx/HjCEd1sPzoVnxIxF3LrcKnepnUf",target:"_blank",rel:"noopener noreferrer",children:"\u591A\u7EF4\u8868\u683C\u63D2\u4EF6API"})]})}),n(s.Select,{field:"table",label:"Select Table",placeholder:"Please select a Table",style:{width:"100%"},onChange:$,children:f.map(({id:e,name:y})=>n(s.Select.Option,{value:e,children:y},e))}),h("div",{style:{display:"flex",gap:"16px",marginBottom:"16px"},children:[n(s.Select,{field:"columnx",label:"Select Column X (Baseline)",placeholder:"Please select a Column as Baseline",style:{flex:1},disabled:t.length===0,children:t.map(e=>n(s.Select.Option,{value:e.id,children:e.name},e.id))}),n(s.Select,{field:"columny",label:"Select Column Y (Comparison)",placeholder:"Please select a Column as Comparison",style:{flex:1},disabled:t.length===0,children:t.map(e=>n(s.Select.Option,{value:e.id,children:e.name},e.id))})]}),h("div",{style:{display:"flex",gap:"16px",marginBottom:"16px"},children:[n(s.Select,{field:"addedColumn",label:"Select 'Added' Column (Text or MultiSelect)",placeholder:"Please select the 'Added' column",style:{flex:1},disabled:w.length===0,children:w.map(e=>n(s.Select.Option,{value:e.id,children:e.name},e.id))}),n(s.Select,{field:"deletedColumn",label:"Select 'Deleted' Column (Text or MultiSelect)",placeholder:"Please select the 'Deleted' column",style:{flex:1},disabled:w.length===0,children:w.map(e=>n(s.Select.Option,{value:e.id,children:e.name},e.id))})]}),n(te,{theme:"solid",htmlType:"submit",style:{marginTop:16},children:"Compare columns"})]})]})}function re(f){const[g,d]=c.exports.useState(!1),b=n("div",{children:h("div",{className:"errTop",children:['After running the project, please get the webview address and paste it into the Base table "Extended Script" for use. See:\xA0',n("a",{target:"_blank",href:"https://bytedance.feishu.cn/docx/HazFdSHH9ofRGKx8424cwzLlnZc",children:"Development Guide"})]})});return c.exports.useEffect(()=>{if(f.neverShowBanner)return;const t=new Promise((l,u)=>{setTimeout(()=>{u(!1)},3e3)});Promise.race([C.bridge.getLanguage(),t]).then(l=>{d(!1)}).catch(()=>{d(!0)})},[]),f.neverShowBanner?f.children||null:h("div",{children:[g&&b,f.children]})}k.createRoot(document.getElementById("root")).render(n(re,{children:n(ne,{})}));
