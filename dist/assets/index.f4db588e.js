import{a as Q,r as c,b as y,j as t}from"./react-vendor.348c3435.js";import{k as w,j as R}from"./lark-sdk.f4afa2a9.js";import{B as ee,F as s,a as te}from"./semi-ui.cc07b1c5.js";import"#minpath";import"#minproc";import"#minurl";(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))b(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&b(u)}).observe(document,{childList:!0,subtree:!0});function d(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function b(n){if(n.ep)return;n.ep=!0;const l=d(n);fetch(n.href,l)}})();var v={},V=Q.exports;v.createRoot=V.createRoot,v.hydrateRoot=V.hydrateRoot;function ne(){const[h,f]=c.exports.useState([]),[d,b]=c.exports.useState(),[n,l]=c.exports.useState([]),u=c.exports.useRef(null),X=c.exports.useCallback(async e=>{const{table:g,columnx:i,columny:x,addedColumn:F,deletedColumn:L}=e;if(!g||!i||!x||!F||!L){alert("Please select all required columns");return}try{const p=await w.base.getTableById(g),$=await p.getFieldMetaList(),k=r=>$.find(o=>o.id===r),J=k(i),Y=k(x),q=k(F),U=k(L),M=(r,o)=>{const a=r==null?void 0:r.property;if(!a||!a.options)return o;const S=a.options.find(T=>T.id===o);return S?S.name:o},P=(r,o)=>o?Array.isArray(o)?o.map(a=>typeof a=="object"?a.text||a.name||JSON.stringify(a):M(r,String(a))):typeof o=="object"?[o.text||o.name||JSON.stringify(o)]:[M(r,String(o))]:[];let D=!0,O;const j=[];for(;D;){const r=await p.getRecords({pageSize:100,pageToken:O});j.push(...r.records),D=r.hasMore,O=r.pageToken}const A=[];j.forEach(r=>{const o=r.fields[i],a=r.fields[x],S=P(J,o),T=P(Y,a),z=T.filter(m=>!S.includes(m)),H=S.filter(m=>!T.includes(m));console.log(`Record ${r.recordId}: Added: [${z.join(", ")}], Deleted: [${H.join(", ")}]`);const _=(m,B)=>{if(!B.length)return"";if((m==null?void 0:m.type)===R.MultiSelect){const E=m.property;return B.map(I=>{var K;const G=(K=E==null?void 0:E.options)==null?void 0:K.find(Z=>Z.name===I);return G?{id:G.id}:null}).filter(I=>I!==null)}return B.join(", ")};A.push({recordId:r.recordId,fields:{[F]:_(q,z),[L]:_(U,H)}})});const N=50;for(let r=0;r<A.length;r+=N){const o=A.slice(r,r+N);await p.setRecords(o)}alert("Columns compared and updated successfully!")}catch(p){console.error(p),alert("Failed to compare columns: "+(p instanceof Error?p.message:String(p)))}},[]);c.exports.useEffect(()=>{(async()=>{var x;const[g,i]=await Promise.all([w.base.getTableMetaList(),w.base.getSelection()]);f(g),i!=null&&i.tableId&&(b(i.tableId),(x=u.current)==null||x.setValues({table:i.tableId}))})()},[]);const W=c.exports.useCallback(e=>{b(typeof e=="string"?e:void 0)},[]);c.exports.useEffect(()=>{(async()=>{if(!d)return l([]);const i=await(await w.base.getTableById(d)).getFieldMetaList();l(i)})()},[d]);const C=n.filter(e=>e.type===R.Text||e.type===R.MultiSelect);return y("main",{className:"main",children:[t("h4",{children:"Compare Columns"}),t(ee,{type:"info",description:"Select two columns to compare. Differences will be written to the 'Added' and 'Deleted' columns (Text or MultiSelect).",style:{marginBottom:16}}),y(s,{labelPosition:"top",onSubmit:X,getFormApi:e=>u.current=e,children:[t(s.Slot,{label:"Reference",children:y("div",{children:[t("a",{href:"https://lark-technologies.larksuite.com/docx/HvCbdSzXNowzMmxWgXsuB2Ngs7d",target:"_blank",rel:"noopener noreferrer",children:"Base Extensions Guide"}),"\u3001",t("a",{href:"https://bytedance.feishu.cn/docx/HazFdSHH9ofRGKx8424cwzLlnZc",target:"_blank",rel:"noopener noreferrer",children:"\u591A\u7EF4\u8868\u683C\u63D2\u4EF6\u5F00\u53D1\u6307\u5357"}),"\u3001",t("a",{href:"https://lark-technologies.larksuite.com/docx/Y6IcdywRXoTYSOxKwWvuLK09sFe",target:"_blank",rel:"noopener noreferrer",children:"Base Extensions Front-end API"}),"\u3001",t("a",{href:"https://bytedance.feishu.cn/docx/HjCEd1sPzoVnxIxF3LrcKnepnUf",target:"_blank",rel:"noopener noreferrer",children:"\u591A\u7EF4\u8868\u683C\u63D2\u4EF6API"})]})}),t(s.Slot,{label:"Data",children:t("div",{children:t("a",{href:"https://bytedance.larkoffice.com/wiki/SMr1w8o9QiEhRUkMN6pcjun3nvh?from=from_copylink",target:"_blank",rel:"noopener noreferrer",children:"Data Template"})})}),t(s.Slot,{label:"Development log",children:t("div",{children:t("a",{href:"https://bytedance.larkoffice.com/wiki/AelJwBthTiXx7xk9G34cRXWInMd",target:"_blank",rel:"noopener noreferrer",children:"Development Guideline"})})}),t(s.Select,{field:"table",label:"Select Table",placeholder:"Please select a Table",style:{width:"100%"},onChange:W,children:h.map(({id:e,name:g})=>t(s.Select.Option,{value:e,children:g},e))}),y("div",{style:{display:"flex",gap:"16px",marginBottom:"16px"},children:[t(s.Select,{field:"columnx",label:"Select Column X (Baseline)",placeholder:"Please select a Column as Baseline",style:{flex:1},disabled:n.length===0,children:n.map(e=>t(s.Select.Option,{value:e.id,children:e.name},e.id))}),t(s.Select,{field:"columny",label:"Select Column Y (Comparison)",placeholder:"Please select a Column as Comparison",style:{flex:1},disabled:n.length===0,children:n.map(e=>t(s.Select.Option,{value:e.id,children:e.name},e.id))})]}),y("div",{style:{display:"flex",gap:"16px",marginBottom:"16px"},children:[t(s.Select,{field:"addedColumn",label:"Select 'Added' Column (Text or MultiSelect)",placeholder:"Please select the 'Added' column",style:{flex:1},disabled:C.length===0,children:C.map(e=>t(s.Select.Option,{value:e.id,children:e.name},e.id))}),t(s.Select,{field:"deletedColumn",label:"Select 'Deleted' Column (Text or MultiSelect)",placeholder:"Please select the 'Deleted' column",style:{flex:1},disabled:C.length===0,children:C.map(e=>t(s.Select.Option,{value:e.id,children:e.name},e.id))})]}),t(te,{theme:"solid",htmlType:"submit",style:{marginTop:16},children:"Compare columns"})]})]})}function re(h){const[f,d]=c.exports.useState(!1),b=t("div",{children:y("div",{className:"errTop",children:['After running the project, please get the webview address and paste it into the Base table "Extended Script" for use. See:\xA0',t("a",{target:"_blank",href:"https://bytedance.feishu.cn/docx/HazFdSHH9ofRGKx8424cwzLlnZc",children:"Development Guide"})]})});return c.exports.useEffect(()=>{if(h.neverShowBanner)return;const n=new Promise((l,u)=>{setTimeout(()=>{u(!1)},3e3)});Promise.race([w.bridge.getLanguage(),n]).then(l=>{d(!1)}).catch(()=>{d(!0)})},[]),h.neverShowBanner?h.children||null:y("div",{children:[f&&b,h.children]})}v.createRoot(document.getElementById("root")).render(t(re,{children:t(ne,{})}));
